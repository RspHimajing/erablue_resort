

@ダンジョン初期処理_バルツ地下廃工場
;ダンジョン構造の読み込み
;0でない時、そのマスは存在する
#DIM 深度
#DIM 分岐

ダンジョンサブタイトル = AVANDONED FACTORY
ダンジョンマス画像URL_伏せ状態 = 壁_工場
ダンジョン現在位置:0 = 3
ダンジョン現在位置:1 = 8
ダンジョン背景画像 = 背景_工場

;スタート地点は必ず存在
;初期からオープン済みなので3を入れる
;ビット0：存在するか　ビット1：移動できるか　ビット2：マスをオープンするか（ビット１をONにしないと無意味）　ビット3：入れないがオープンする場合に使用
;ビット4以降：自由枠。主に宝箱の開閉やイベント達成フラグなどに使用
IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}") == 0
	SETVAR @"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}", 3
ENDIF

FOR 深度, 1, 100
	LOCAL = 0
	FOR 分岐, 0, 9
		IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{深度}:{分岐}")
			;既にマス情報が入ってるなら飛ばす
			LOCAL = 1
			CONTINUE
		ELSEIF ENUMFUNCBEGINSWITH(@"ダンジョンマス情報_%ダンジョン名%_{深度}_{分岐}")
			LOCAL = 1
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:深度:分岐", 1
		ENDIF
	NEXT
	IF LOCAL
		ダンジョン最大深度 = 深度
	ENDIF
NEXT

@ダンジョン解説文_バルツ地下廃工場

詳細文文字列受け渡し変数 = 
詳細文文字列受け渡し変数 += "バルツ地下に存在する廃工場。時折コロッサスの同型機が出てくることがある。<br>"
詳細文文字列受け渡し変数 += "内部には火属性の魔物が住み着いており、腕の立つ騎空士でなければ入るのは危険。<br>"
詳細文文字列受け渡し変数 += "しかし、回収されていない古代の部品など役立つ素材も多く残っている。<br>"

;推奨レベルを返す
RETURN 12



@敵討伐後処理_ダンジョン固有_バルツ地下廃工場(討伐エネミー数)
;ダンジョン内で戦闘した後に呼ばれる関数、主にダンジョンごとのドロップアイテム取得に使用
;まだ敵データはリセットしていないので敵BATTLE_STATEで色々情報は取得可能
#DIM 討伐エネミー数
#DIM ドロップ確率
#DIMS ドロップアイテム

ドロップ確率 = 10 * 討伐エネミー数
ドロップアイテム = 鉄鉱石
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 5 * 討伐エネミー数
ドロップアイテム = 赤熱鉱
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 10 * 討伐エネミー数
ドロップアイテム = 古びた歯車
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 5 * 討伐エネミー数
ドロップアイテム = 星晶の破片
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 1 * 討伐エネミー数
ドロップアイテム = 赤銅の古紋
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

;---------------------------------------------------------------------
;マップ構造
;---------------------------------------------------------------------
;右ルートと左ルートに分岐するが、右ルートは封印してあり左ルートを進まないと解除されない
;解除するとそのまま奥に進んでコロッサスがいる
;クリアすると乗機システムが開放される。落ちてるアイテムだけで最初の乗機は作成可能。
;（鉄鉱石６，赤熱鉱５，古い歯車３）
;---------------------------------------------------------------------
@ダンジョンマス情報_バルツ地下廃工場_0_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 0
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 道を脇に逸れると、鉱石類が雑多に散らばる部屋を見つけた。
			WSTR:(K++) = 資材の仕分けを行う場所だろうか。形がバラバラで規格外のものという印象を受ける。
			WSTR:(K++) = ほとんどは酸化や風化してしまって使い物にならないが……幾つか無事の物を貰っていこう。
			WSTR:(K++) = %CALLNAME:PLAYER%は鉄鉱石を３つ手に入れた！
			CALL 素材入手処理("鉄鉱石", 3)
		ELSE
			KSTR:(K++) = もうめぼしいものはなにもない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_0_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 0
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			KSTR:(K++) = 機械は工場内に冷気を供給している。
		ELSE
			;最初に訪れた時
			WSTR:(K++) = 部屋の中には大型の機械が鎮座している。
			WSTR:(K++) = 壁の全面を覆い尽くし、更に無数のパイプを生やした機械は電源が切れているようだ。_PAGE
			KSTR:(K++) = 機械の電源を入れますか？
			KSTR:(K++) = BUTTON_[入れる]
			KSTR:(K++) = BUTTON_[入れない]
			CALL 知識技能所持者検索("機械知識", 1)
			LOCAL:1 = RESULT
			SIF LOCAL:1 > -1
				KSTR:(K++) = BUTTON_[内部を覗いてみる]
			$LOOP_MESSAGE
			CALL メッセージ欄表示用関数(,,,0)
			BINPUTS
			SELECTCASE RESULTS
				CASE "[入れる]"
					CALL 口上変数初期化
					WSTR:(K++) = %CALLNAME:PLAYER%がスイッチを入れると、轟音を立てながら機械が起動する。
					WSTR:(K++) = 機械からは強い冷気が吹き出し、君たちを直撃する！
					WSTR:(K++) = 全員のＭＰが５０減少した！
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					FOR LOCAL, 0, 4
						SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
							CONTINUE
						BATTLE_STATE:LOCAL:ＭＰ = MAX(BATTLE_STATE:LOCAL:ＭＰ - 50, 0)
					NEXT
					WSTR:(K++) = 凍死しかねない寒さに、君たちは慌てて部屋の外へと逃げ出した。
					WSTR:(K++) = どうやら機械の設定がおかしくなっていたらしい。
					WSTR:(K++) = 機械知識があれば正しく動かせたかもしれないが……ともあれ、これで移動出来る範囲が増えたはずだ。
					SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
				CASE "[入れない]"
					CALL 口上変数初期化
					WSTR:(K++) = 一旦そのままにしておこう。
				CASE "[内部を覗いてみる]"
					WSTR:(K++) = 機械の構造を覗いてみる。
					WSTR:(K++) = どうやら内部のギアを組み替えることで、冷気の噴出先を設定することが出来るようだ。
					WSTR:(K++) = 今の設定では、この部屋そのものにも冷気が吹き出してしまうだろう。
					WSTR:(K++) = %CALLNAME:(LOCAL:1)%はギアを組み換え、この部屋を対象外に設定し機械を動かした。_PAGE
					WSTR:(K++) = …………どうやら正しく動いているようだ。
					WSTR:(K++) = これで移動出来る範囲が増えただろう。今まで通れなかった場所に行ってみよう。
					SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_1_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 1
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 上アイコン
	CASE "接続先"
	CASE "マスイベント"
		;13_8へ
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ベルトコンベアは奥へと続いている。
			WSTR:(K++) = 奥からは金属製のものが動く音が、遠くに聞こえる……。
			WSTR:(K++) = 暴走機械はまだ出てくるようだ。用心して進もう
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(13, 8)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		ダンジョン現在位置:0 = 13
		ダンジョン現在位置:1 = 8
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_1_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 1
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "0_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "1_0")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = ベルトコンベアの先には、荷物を右から左へ、左から右へと移動させている機械たちがいた。
			WSTR:(K++) = どうやら暴走し、無意味なことをずっと繰り返してしまっているようだ。
			WSTR:(K++) = 君たちが姿を見せると、暴走機械たちは新しい仕事を見つけたと言わんばかりに襲いかかってくる！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:0:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:2:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:4:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:3:エネミー名 = Lv12_暴走機械A
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = %CALLNAME:PLAYER%たちは暴走機械を鎮圧した。
				WSTR:(K++) = 運んでいた荷物はただの瓦礫で、特に使えそうなものはない。
				WSTR:(K++) = むしろ暴走機械から鉄鉱石や赤熱鉱を剥ぎ取る方が役立ちそうだ。
				WSTR:(K++) = 倒した際に無事な鉱石を見かけたら回収していこう。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:2:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:4:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:3:エネミー名 = Lv12_暴走機械A
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_1_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 1
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "1_2")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路を進むと、壊れたベルトコンベアを見つけた。
			WSTR:(K++) = どうやらこの奥が資材の仕分け場所になっており、このベルトコンベアを通じて資材を運んでいく仕組みらしい。
			WSTR:(K++) = この先に進めば残った鉱石類を拾えるかもしれない。
			WSTR:(K++) = 使えるアイテムを見逃さないように進もう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 壊れたベルトコンベアが続いている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_2_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 魔力が滞留し、星晶になって部屋の壁で結晶化している。
			WSTR:(K++) = 魔力の多い土地でたまに見かける現象だが、手つかずで残っているのを見つけるのは珍しい。
			WSTR:(K++) = 大きい欠片を少し貰っていこう。_PAGE
			WSTR:(K++) = %CALLNAME:PLAYER%は星晶の欠片を１つ手に入れた！
			CALL 素材入手処理("星晶の欠片", 1)
		ELSE
			KSTR:(K++) = 壁を結晶化した星晶がうっすらと覆っている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_2_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "0_7")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0 && GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:7, 4)
			;開くパターン
			WSTR:(K++) = %CALLNAME:PLAYER%は手に入れたカードキーで扉を開いた。
			SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			KSTR:(K++) = 既にカードキーの扉は開いている。
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 道の先には、つるりとした扉が道を塞いでいる。
			WSTR:(K++) = 扉には持ち手がなく、開こうとしてもびくともしない。
			WSTR:(K++) = 扉の横には細長い穴が一つ開いていた。
			WSTR:(K++) = これが鍵穴だろうか……？　どこかで板状の物を見つけたら試してみよう。
		ELSE
			KSTR:(K++) = 扉は開きそうにない。
			KSTR:(K++) = 扉の横には細長い穴が一つ開いている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_3_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 3
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "1_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_5")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = この工場は古代に星の民が作り、ドラフが反乱の末に奪った施設らしい。
			WSTR:(K++) = 年数が経っているにも関わらず通路や壁に目立った劣化が無いのは流石星の民と言ったところか。
			WSTR:(K++) = しかし流石に紙類はその限りではないようだ。
			WSTR:(K++) = 壁には「工場内施設図」と刻印されているが、その下に貼られていた紙はボロボロに崩れてしまっている。
			WSTR:(K++) = これではまともに読み取ることは出来ないだろう。自らの足で探索するしかなさそうだ。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 工場のマップはボロボロにくずれてしまっている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_3_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 3
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_7")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "3_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_7")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 工場の中に入ると、大きな警報音が響き渡る！
			WSTR:(K++) = どうやら工場の機械が%CALLNAME:PLAYER%たちを侵入者と見なしたようだ。
			WSTR:(K++) = 問答無用で暴走した機械が襲いかかってくる！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:0:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:2:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:5:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:7:エネミー名 = Lv12_暴走機械B
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = %CALLNAME:PLAYER%たちは暴走機械を鎮圧した。
				WSTR:(K++) = 長い時間が経っても動き続けることは脅威だが、対処出来ない程ではないようだ。
				WSTR:(K++) = しかし油断が出来るほどでもない。警戒しながら進もう。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:2:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:5:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:7:エネミー名 = Lv12_暴走機械B
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_3_8(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 3
マス分岐 = 8

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "3_7")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = %CALLNAME:PLAYER%はバルツ地下の廃工場へと足を踏み入れた。
			WSTR:(K++) = 以前に起こった事件以来、この工場からたまに暴走した機械型星晶獣が出現するらしい。
			WSTR:(K++) = 普段は腕の立つ騎空士に対処を依頼しているようだが、今回はよろず屋の伝手で依頼に割り込ませてもらった。_PAGE
			IF 鍛冶場作成許可フラグ
				WSTR:(K++) = ここにいる星晶獣は、古代のドラフが開発したと聞く。
				WSTR:(K++) = ならば乗機開発に役立つ知識や素材が残っていても不思議ではない。
				WSTR:(K++) = 見逃さないよう、くまなく探索していこう。
			ELSE
				WSTR:(K++) = ここにいる星晶獣は、古代のドラフが開発したと聞く。
				WSTR:(K++) = 鍛冶・開発という概念に非常に近しい存在だ。鍛冶場の作成にはぴったりだろう。
			ENDIF
			WSTR:(K++) = %CALLNAME:PLAYER%は無骨な鉄と火に囲まれた工場へと足を踏み入れる。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 無骨な鉄と火が目立つ廃工場だ。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_4_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 上アイコン
	CASE "接続先"
	CASE "マスイベント"
		;17_8へ
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ところどころが溶けた通路はまだ先に続いている。
			WSTR:(K++) = 火の魔力は未だ濃密に周囲を満たしている。
			WSTR:(K++) = この先ではやはり、火の精霊が多く出てくるようだ。気をつけて進もう。
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(17, 8)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		ダンジョン現在位置:0 = 17
		ダンジョン現在位置:1 = 8
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_4_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_0")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_3")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 通路の先に動く光が見える。
			WSTR:(K++) = それは赤く揺れ動く炎のように見えるが、しかし自らの意思で動いているようにも思える。
			WSTR:(K++) = …………あれは火の精霊だ！　住処に侵入した%CALLNAME:PLAYER%たちに襲いかかってくる！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:0:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:4:エネミー名 = Lv13_火のエレメンタル
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = なんとか火の精霊たちを撃退することに成功した。
				WSTR:(K++) = このタイプの精霊は比較的防御が薄い代わりに攻撃力に長けている。
				WSTR:(K++) = 防御や回復、攻撃デバフなどの手段を用意すると安全に戦えるだろう。
				WSTR:(K++) = %CALLNAME:PLAYER%たちは更に先の通路に進む。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:4:エネミー名 = Lv13_火のエレメンタル
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_4_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_7")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路横の部屋に入ってみると、そこはロッカールームのようだった。
			WSTR:(K++) = 工場でかつて働いていた者たちが着替えるための場所らしい。
			WSTR:(K++) = 調べてみると、ジョブの証が転がっていた。_PAGE
			WSTR:(K++) = これも星の民の技術で作られたものだろうか。長い時間放置されていたはずなのに損傷は見当たらない。
			WSTR:(K++) = 装着すれば、機械に詳しくなれそうだ。このダンジョンの探索に役立つだろう。
			WSTR:(K++) = ジョブの証「メカニックの証」を手に入れた！
			CALL 汎用証取得処理("メカニックの証")
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もうめぼしいものはなにもない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_5_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_3")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路を進むと、ほんのりと気温が高くなったような気がした。
			CALL 知識技能所持者検索("機械知識", 1)
			LOCAL = RESULT
			IF LOCAL < 0
				CALL 知識技能所持者検索("魔法知識", 1)
				LOCAL = RESULT
			ENDIF
			IF LOCAL > -1
				WSTR:(K++) = %CALLNAME:LOCAL%は少し先の天井がおかしいと気づいた。
				WSTR:(K++) = 天井にはスリット状の穴が幾つも空いた換気口のようなものがある。
				KSTR:(K++) = 試しにそこへ向けて石ころを投げてみると、換気口から熱風が凄い勢いで吹き出した！！_PAGE
				WSTR:(K++) = どうやら火の魔力がダクトに溜まっていて、刺激と同時に吹き出したようだった。
				WSTR:(K++) = %CALLNAME:PLAYER%たちは油断していては危ないと、気を引き締めて探索を再開する。
			ELSE
				WSTR:(K++) = %CALLNAME:PLAYER%たちが不思議に思いながら通路を進むと、突然天井から熱風が吹き出してきた！
				WSTR:(K++) = 全員のＨＰが１５０減少した！
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				FOR LOCAL, 0, 4
					SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
						CONTINUE
					BATTLE_STATE:LOCAL:ＨＰ = MAX(BATTLE_STATE:LOCAL:ＨＰ - 150, 0)
				NEXT
				WSTR:(K++) = どうやら火の魔力が換気口の奥に滞留し、通路を通った振動で刺激され吹き出してきたらしい。
				WSTR:(K++) = 機械か魔法の知識があれば防げたかもしれないが……。
				WSTR:(K++) = %CALLNAME:PLAYER%たちは火傷へ応急手当をしてから探索を再開する。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もう熱気は吹き出してこないようだ。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_5_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_3")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路を進むと、壁と床が歪な形に変形していた。
			WSTR:(K++) = 頑丈に作られただろう扉もどろどろに融解した形で固まっている。
			WSTR:(K++) = どうにも、想定されていない超高熱に晒されたように見える……。_PAGE
			WSTR:(K++) = 古代に起きた事故の痕跡だろうか？　ともあれ、この先には火の魔力が強く渦巻いている。
			WSTR:(K++) = 火の精霊が多く出現するかもしれない。水属性の耳飾りを準備しておくと楽になるだろう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 壁と床が歪な形に変形している。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_6_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 6
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		IF ダンジョン内一時変数:1 == 0
			ダンジョンマス画像URL_重ね表示 = えっちハート
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		;えっちイベ
		IF ダンジョン内一時変数:1
		ELSE
			CALL ダンジョンハプニング基本処理()
			IF RESULT
				ダンジョン内一時変数:1 = 1
			ENDIF
			CALL 口上変数初期化
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_6_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 6
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_1")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 融解した壁や床がずっと続いている。
			WSTR:(K++) = 既に固まっているため進むことに支障はないが、どんな火力があればここまで破壊されるのだろうか。
			WSTR:(K++) = もうこの工場に動力は繋がっていないため、同じ事故が起きることが無いとはいえ……
			WSTR:(K++) = あまり長居したい空間じゃないな、と%CALLNAME:PLAYER%は思った。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 融解した壁や床がずっと続いている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_6_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 6
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		IF ダンジョン内一時変数:0 == 0
			ダンジョンマス画像URL_重ね表示 = 回復アビ
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		IF ダンジョン内一時変数:0
		ELSE
			KSTR:(K++) = ロッカールームの奥に仮眠室があった。施錠可能で安全そうだ。
			KSTR:(K++) = 少し休憩していきますか？
			KSTR:(K++) = （PTメンバー全回復・ダンジョンを一度出るまで消滅）
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					KSTR:(K++) = 君たちは仮眠室で十分な休息を取り、体力を回復した！
					CALL メッセージ欄表示用関数()
					ダンジョン内一時変数:0 = 1
					FOR LOCAL, 0, 4
						IF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
							BREAK
						ENDIF
						BATTLE_STATE:LOCAL:ＨＰ = BATTLE_STATE:LOCAL:最大ＨＰ
						BATTLE_STATE:LOCAL:ＭＰ = BATTLE_STATE:LOCAL:最大ＭＰ
					NEXT
				CASE "[いいえ]"
					KSTR:(K++) = まだ休憩するほど疲れてはいない。先に進もう。
					CALL メッセージ欄表示用関数()
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
		ENDIF
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_バルツ地下廃工場_8_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 8
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 部屋いっぱいにモニターや計器、スイッチがある部屋に出た。
			WSTR:(K++) = どうやら工場内を監視するための設備らしい。どれも壊れてしまっているが……
			WSTR:(K++) = ……周囲を探してみると、金属で出来たプレートを見つけた。_PAGE
			WSTR:(K++) = プレートには「冷却装置操作手順」と書かれている。
			WSTR:(K++) = 「・工場内が異常加熱された場合、入り口左の冷却装置を起動すること。
			WSTR:(K++) = 　・その際、冷却場所を設定するため機械知識のある職員が操作すること。
			WSTR:(K++) = 　・暑いからといって涼むために冷却装置を使わないこと」
			WSTR:(K++) = ……と書かれている。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 「冷却装置操作手順」と書かれたプレートがある。
			KSTR:(K++) = 「・工場内が異常加熱された場合、入り口左の冷却装置を起動すること。
			KSTR:(K++) = 　・その際、冷却場所を設定するため機械知識のある職員が操作すること。
			KSTR:(K++) = 　・暑いからといって涼むために冷却装置を使わないこと」
			KSTR:(K++) = ……と書かれている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_8_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 8
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "8_5")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0 && GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:7, 4)
			;開くパターン
			WSTR:(K++) = %CALLNAME:PLAYER%は手に入れたカードキーで扉を開いた。
			SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			KSTR:(K++) = 既にカードキーの扉は開いている。
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 道の先には、つるりとした扉が道を塞いでいる。
			WSTR:(K++) = 扉には持ち手がなく、開こうとしてもびくともしない。
			WSTR:(K++) = 扉の横には細長い穴が一つ開いていた。
			WSTR:(K++) = これが鍵穴だろうか……？　どこかで板状の物を見つけたら試してみよう。
		ELSE
			KSTR:(K++) = 扉は開きそうにない。
			KSTR:(K++) = 扉の横には細長い穴が一つ開いている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_バルツ地下廃工場_10_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;アイテムあるパターン
			WSTR:(K++) = %CALLNAME:PLAYER%は部屋の奥に大きなレバーを発見した。
			WSTR:(K++) = レバーの上には金属プレートが付いており、「ベルトコンベア起動スイッチ」と書いてある。
			KSTR:(K++) = レバーを下ろしますか？
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:13:5, 4)
						WSTR:(K++) = レバーを下ろすと、ごぅんごぅんと音を立ててベルトコンベアが動き始めた。
						WSTR:(K++) = 周囲が色々と変化しているかもしれない。もう一度探索してみよう。
						CALL メッセージ欄表示用関数(,,,0)
						SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
					ELSE
						WSTR:(K++) = レバーを下ろそうとしたが、途中でロックされている。
						WSTR:(K++) = どうやらベルトコンベア途中の扉が閉まっていることが原因のようだ。
						WSTR:(K++) = どこかにそれらしき扉があっただろうか？　探して開けてみよう。
						CALL メッセージ欄表示用関数(,,,0)
					ENDIF
				CASE "[いいえ]"
					WSTR:(K++) = すぐには触らず、一旦置いておこう。
					CALL メッセージ欄表示用関数(,,,0)
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
		ELSE
			KSTR:(K++) = 既にベルトコンベアは起動している。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_10_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:1, 4)
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_1")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0 && GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:1, 4)
			;アイテムあるパターン
			WSTR:(K++) = %CALLNAME:PLAYER%はベルトコンベアを流れてくる魔石の山を発見した。
			WSTR:(K++) = 機械の動力用に保存されていた資材だろうか。
			WSTR:(K++) = 幸いにも、まだ使える魔石が多く残っている。ありがたく貰っていこう
			WSTR:(K++) = %CALLNAME:PLAYER%は魔石を１０個手に入れた。
			SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			CALL アイテム増減汎用処理("魔石", 10)
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			KSTR:(K++) = めぼしいものはもう何もない。
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ベルトコンベアの上には何もない。
			WSTR:(K++) = 周囲にも特に変わったところはないようだ。
		ELSE
			KSTR:(K++) = ベルトコンベアの上には何もない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 接続ルート全開放処理(マス深度, マス分岐)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_10_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:1, 4)
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_7")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0 && GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:1, 4)
			;アイテムあるパターン
			WSTR:(K++) = %CALLNAME:PLAYER%はベルトコンベアを流れてくる紙束を発見した。
			WSTR:(K++) = ……どうやら星晶獣コロッサスをダウングレードした機体の設計図のようだ。
			IF 鍛冶場作成許可フラグ
				WSTR:(K++) = これがあれば、新しい乗機を生産できそうだ！
			ELSE
				WSTR:(K++) = 何かの役に立つかもしれない。もらっていこう。
			ENDIF
			WSTR:(K++) = %CALLNAME:PLAYER%は「コロッサス・レプリカの設計図」を手に入れた。
			CALL 乗機取得処理_設計図("コロッサスレプリカ")
			SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			KSTR:(K++) = めぼしいものはもう何もない。
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ベルトコンベアの上には何もない。
			WSTR:(K++) = 周囲にも特に変わったところはないようだ。
		ELSE
			KSTR:(K++) = ベルトコンベアの上には何もない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 接続ルート全開放処理(マス深度, マス分岐)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_10_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン_赤
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "12_7")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "8_7")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = ベルトコンベアの上に、今までの暴走機械とは違う巨大な機械が居座っている。
			WSTR:(K++) = 動作は不規則で、遠くから見ても暴走しているとわかるが……かなり強そうな相手のようだ。
			WSTR:(K++) = しかし巨大故に死角も多い。倒さずとも奥には進めそうだ。_PAGE
			KSTR:(K++) = 巨大な機械と戦いますか？
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					CALL 口上変数初期化
					WSTR:(K++) = %CALLNAME:PLAYER%たちは武器を構え、巨大な機械に戦いを挑んだ！
					CALL メッセージ欄表示用関数(,,,0)
					敵BATTLE_STATE_STR:0:エネミー名 = Lv16_巨大管理機械
					CALL 雑魚敵遭遇汎用処理
					IF RESULT == 0
						;勝利時のみ先へ進む
						CALL 口上変数初期化
						WSTR:(K++) = %CALLNAME:PLAYER%たちは無事に巨大機械を制圧した！
						WSTR:(K++) = 戦闘の衝撃で機械の背面部のカバーが外れると、そこには板状の部品が刺さっている様子が見える。
						WSTR:(K++) = 先程見た「どうやっても開かない扉」の横にあった、スリット状の穴にサイズがぴったりなようだ。
						WSTR:(K++) = これを使えばあの扉が開くかもしれない。試してみよう。
						WSTR:(K++) = %CALLNAME:PLAYER%はカードキーを手に入れた！
						CALL メッセージ欄表示用関数(,,,0)
						SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
					ENDIF
				CASE "[いいえ]"
					CALL 口上変数初期化
					WSTR:(K++) = 相手は強敵だ。準備を万端にしてから挑もう。
					CALL メッセージ欄表示用関数(,,,0)
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 巨大管理機械との戦いの記憶を思い起こしますか？
			KSTR:(K++) = （中ボスと再戦）
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE2
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					敵BATTLE_STATE_STR:0:エネミー名 = Lv16_巨大管理機械
					CALL 雑魚敵遭遇汎用処理
				CASE "[いいえ]"
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE2
			ENDSELECT
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_11_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 11
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:1, 4)
			ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_3")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0 && GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:1, 4)
			;敵がいるパターン
			WSTR:(K++) = ごぅんごぅんと音を立ててベルトコンベアが動いている。
			WSTR:(K++) = ……なんとベルトコンベアが暴走した機械を運んできてしまった！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:1:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:5:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:2:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:4:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:6:エネミー名 = Lv12_暴走機械B
			CALL 雑魚敵遭遇汎用処理

			WSTR:(K++) = またベルトコンベアが新しい敵を運んでくるかもしれない。
			WSTR:(K++) = %CALLNAME:PLAYER%たちは急いでこの場から離れた。
			CALL メッセージ欄表示用関数(,,,0)
			SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			敵BATTLE_STATE_STR:1:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:5:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:2:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:4:エネミー名 = Lv12_暴走機械B
			敵BATTLE_STATE_STR:6:エネミー名 = Lv12_暴走機械B
			CALL 雑魚敵繰り返し戦闘処理
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ベルトコンベアの上には何もない。
			WSTR:(K++) = 周囲にも特に変わったところはないようだ。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			KSTR:(K++) = ベルトコンベアの上には何もない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 接続ルート全開放処理(マス深度, マス分岐)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_12_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 12
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_7")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 壊れたベルトコンベアの左右に、大きなアームを付けた機械たちが並んでいる。
			WSTR:(K++) = コンベアで流れてきた資材を仕分けるための機械に見えるが……
			WSTR:(K++) = ……君たちが近づくと、アームを大きく振り回し始める！　やはり暴走しているようだ！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:1:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:3:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:4:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:6:エネミー名 = Lv12_暴走機械B
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = %CALLNAME:PLAYER%たちは暴走機械を鎮圧した。
				WSTR:(K++) = アームの中に、きらりと光る部品が見える……。
				WSTR:(K++) = まだ使えそうな歯車だ。せっかくなので頂いていこう。
				WSTR:(K++) = %CALLNAME:PLAYER%は古びた歯車を３つ手に入れた！
				CALL 素材入手処理("古びた歯車", 3)
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:1:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:3:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:4:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:6:エネミー名 = Lv12_暴走機械B
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_13_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_5")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0 && GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:1, 4)
			;アイテムあるパターン
			WSTR:(K++) = %CALLNAME:PLAYER%はベルトコンベアを流れてくる紙束を発見した。
			WSTR:(K++) = ……しかし、どれもこれも焼け焦げていてまともに読めなさそうだ。
			WSTR:(K++) = 試しに手で持ってみると、ぼろぼろと崩れて炭の山になってしまった。
			WSTR:(K++) = 他の場所を探索しよう。
			SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			KSTR:(K++) = ただの炭の山しか残っていない。
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ベルトコンベアの上には何もない。
			WSTR:(K++) = 周囲にも特に変わったところはないようだ。
		ELSE
			KSTR:(K++) = ベルトコンベアの上には何もない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 接続ルート全開放処理(マス深度, マス分岐)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_13_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "15_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_3")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0 && GETBIT(ダンジョン構造配列_バルツ地下廃工場:10:7, 4)
			;開くパターン
			WSTR:(K++) = %CALLNAME:PLAYER%は手に入れたカードキーで扉を開いた。
			SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			KSTR:(K++) = 既にカードキーの扉は開いている。
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 道の先には、つるりとした扉が道を塞いでいる。
			WSTR:(K++) = 扉には持ち手がなく、開こうとしてもびくともしない。
			WSTR:(K++) = 扉の横には細長い穴が一つ開いていた。
			WSTR:(K++) = これが鍵穴だろうか……？　どこかで板状の物を見つけたら試してみよう。
		ELSE
			KSTR:(K++) = 扉は開きそうにない。
			KSTR:(K++) = 扉の横には細長い穴が一つ開いている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_13_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "12_7")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ベルトコンベアは正面と左に分岐して続いている。
			WSTR:(K++) = しかし、正面の道は分厚い扉で封鎖されているようだ。
			SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:2:7, 2)
				WSTR:(K++) = 入り口近くで見かけたあの扉と同じ構造のように思える。
			WSTR:(K++) = 今はあの扉を開ける方法はなさそうだ。左に進もう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = ベルトコンベアは正面と左に分岐して続いている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_13_8(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 8

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 下アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_7")
	CASE "マスイベント"
		;1_0へ
		ダンジョン現在位置:0 = 1
		ダンジョン現在位置:1 = 0
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_バルツ地下廃工場_15_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 15
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = カードキー扉の奥には、大量の鉱石が積まれた通路があった。
			WSTR:(K++) = 通路は崩落していて先に進めないが、まだ使える鉱石が多く残っている。
			WSTR:(K++) = この廃工場で取得したものは全て持って帰ってもいいという契約だ。
			WSTR:(K++) = 遠慮なく持ち帰ろう。
			WSTR:(K++) = %CALLNAME:PLAYER%は鉄鉱石を３個、赤熱鉱を５個手に入れた！
			CALL 素材入手処理("鉄鉱石", 3)
			CALL 素材入手処理("赤熱鉱", 5)
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もう使えそうな鉱石は残っていない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_16_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 16
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路のようになっているが、瓦礫で崩れて通れなくなっている。
			WSTR:(K++) = 位置関係からして、向こう側のベルトコンベアのエリアから鉱石類を受け取るための通路だろうか？
			WSTR:(K++) = しかし、こちら側に残っている鉱石はどれも風化していて使えないようだ。
			IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:15:5, 2) == 0
				WSTR:(K++) = 通路の向こう側にならまだ使える鉱石が残っているかもしれない。
			ENDIF
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 瓦礫で崩れて通れない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_17_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 17
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "18_1")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 炎精霊を退けて先に進むと、奥から強いプレッシャーが襲ってくる！
			WSTR:(K++) = どうやら上位の精霊がこの先に陣取っているようだ……。
			WSTR:(K++) = 工場内にいる他のエネミーとは一線を画す強さを感じる。
			WSTR:(K++) = 恐らく、_COLOR_%カラーパレット_HTML("真っ赤")%_Lv35前後_は無いと厳しいだろう。
			WSTR:(K++) = 一旦別の道を探索するのも良いかもしれない。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:18:1, 4)
			;強敵撃破後
			KSTR:(K++) = 強敵は既に打倒した。
		ELSE
			KSTR:(K++) = 強敵の気配を感じる……_COLOR_%カラーパレット_HTML("真っ赤")%_Lv35前後_は無いと厳しいだろう。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_17_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 17
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "17_1")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = %CALLNAME:PLAYER%たちが工場を進むと、炎の精霊たちが行く手を阻むように集まってきた！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:0:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:5:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:2:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:6:エネミー名 = Lv13_火のエレメンタル
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 無事に精霊を退けたが、なんだか動きが妙だったような気がする。
				WSTR:(K++) = 大体の精霊は近くに来た者を攻撃する程度だが、先程の精霊たちは通路の先に行かせまいとしていた。
				WSTR:(K++) = 何かが奥にあるのだろうか？
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:5:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:2:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:6:エネミー名 = Lv13_火のエレメンタル
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_17_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 17
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "17_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "20_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "16_5")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0 && GETBIT(ダンジョン構造配列_バルツ地下廃工場:0:7, 4)
			;進めるパターン
			WSTR:(K++) = 冷却装置が動き、工場内を冷やしている。
			IF 初来訪マス判定用フラグ
				WSTR:(K++) = どうやらこのあたりは冷却しなければ通れないほどに熱されていたようだ。
			ENDIF
			WSTR:(K++) = これで問題なく通行出来るだろう。%CALLNAME:PLAYER%たちは先へと進む。
			SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			KSTR:(K++) = 冷却装置が動き、工場内を冷やしている。
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路を進むと、熱気がどんどん強くなっていく。
			WSTR:(K++) = 壁に素手で触れると火傷してしまいそうなくらいだ。
			WSTR:(K++) = このまま先に進むことは自殺行為だろう。なんとかして熱気を冷ます方法を探さなければならない。
			WSTR:(K++) = %CALLNAME:PLAYER%たちは一旦引き返すことにした……。
		ELSE
			KSTR:(K++) = なんとかして熱気を冷ます方法を探さなければ先に進むことは出来ない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_17_8(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 17
マス分岐 = 8

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 下アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "17_5")
	CASE "マスイベント"
		;4_0へ
		ダンジョン現在位置:0 = 4
		ダンジョン現在位置:1 = 0
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_18_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 18
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン_赤
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "18_4")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			CALL 強敵マス確認
			SIF RESULT == 1
				RETURN 0
			;最初に訪れた時
			WSTR:(K++) = %CALLNAME:PLAYER%たちの前に、火の上位精霊が姿を現す。
			WSTR:(K++) = 火炎を噴出しながら巨大な腕を振りかざし、強い熱気を放っている。
			WSTR:(K++) = 精霊は身を大きく震わせ、%CALLNAME:PLAYER%たちに襲いかかってきた！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:0:エネミー名 = Lv35_火霊バルトロメウス
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
				WSTR:(K++) = %CALLNAME:PLAYER%たちはなんとか強敵を打倒することに成功した！
				WSTR:(K++) = 強敵は幾つかの装飾品と、財宝を持っていた。
				WSTR:(K++) = 火霊バルトロメウスから指輪「精霊の指輪・火」を手に入れた！
				WSTR:(K++) = 火霊バルトロメウスから耳飾り「精霊の耳飾り・火」を手に入れた！
				WSTR:(K++) = 火霊バルトロメウスから100,000ルピを手に入れた！
				MONEY += 100000
				CALL 汎用指輪取得処理("精霊の指輪・火", 3)
				CALL 汎用耳飾り取得処理("精霊の耳飾り・火")
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				CALL 口上変数初期化
			ELSEIF RESULT == -1
				;逃走時
				WSTR:(K++) = %CALLNAME:PLAYER%たちはなんとか強敵から逃げ出すことに成功する。
				WSTR:(K++) = 次はもう少し強くなってから挑戦しよう…
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			ENDIF
		ELSE
			KSTR:(K++) = 強敵は既に打倒した後だ。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_18_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 18
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[緋焔]マーズ"),100,,,1,1)
			LOCALS = %立ち絵リソース記録%
			;最初に訪れた時
			WSTR:(K++) = 火の上位精霊を倒した先では、背の高い美女が眠っていた。
			WSTR:(K++) = 強い火の魔力と光の魔力を感じる……恐らく彼女は空の民ではない。星晶獣だろう。
			WSTR:(K++) = %CALLNAME:PLAYER%が一歩近づくと、彼女はゆっくりと目を開く。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「────上位精霊が倒されたかと思えば」
			WSTR:(K++) = 「変わった気配の人間じゃないか」
			WSTR:(K++) = 美女は起き上がり、%CALLNAME:PLAYER%のことをじっくりと眺めている。
			CALL メッセージ欄表示用関数(LOCALS,"謎の美女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ここは機械型星晶獣の住む場所じゃないのか？　と%CALLNAME:PLAYER%は尋ねる。
			WSTR:(K++) = 彼女のような存在がいるとは噂ですら聞いたこともない。
			WSTR:(K++) = 誰にも気づかれないまま、ここで眠っていたのは何故だろうか。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「あぁ、単純な話さ」
			WSTR:(K++) = 「強い相手を待ってたんだよ。上位精霊を倒せるくらいの戦士を」
			WSTR:(K++) = 「あたしと熱い戦いが出来るほどの相手をね……！」
			CALL メッセージ欄表示用関数(LOCALS,"謎の美女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 強い殺気を叩きつけられ、%CALLNAME:PLAYER%たちは咄嗟に武器を構える。
			WSTR:(K++) = 感じるプレッシャーからして、彼女は先程の上位精霊よりも数段強い……！
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 警戒する%CALLNAME:PLAYER%たちを見て、しかし星晶獣は殺気を収めた。
			WSTR:(K++) = 「いい反応だ。今すぐに、味わってもいいんだが……」
			WSTR:(K++) = 「……あんたたちはもっと強くなる。その時を待つのも悪くない」
			WSTR:(K++) = 「今までも眠っていたくらいだ。多少待つくらい、変わらないね」
			CALL メッセージ欄表示用関数(LOCALS,"謎の美女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 理屈はともかく、上位精霊と星晶獣の連戦にならずに済んで%CALLNAME:PLAYER%はほっと息を吐く。
			WSTR:(K++) = とはいえ、この星晶獣を完全に野放しにするのもあまりよろしくはないだろう。
			WSTR:(K++) = どこまで見張れるかはわからないが……ダメ元で%CALLNAME:PLAYER%はリゾート島のことを紹介した。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「へぇ……？　リゾートはどうでもいいが、強い人間が集まっているってのはいいね」
			WSTR:(K++) = 「暇を潰す種くらいにはなるだろう。気が向いたらお邪魔させてもらうよ」
			CALL メッセージ欄表示用関数(LOCALS,"謎の美女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「あたしは星晶獣マーズ」
			WSTR:(K++) = 「あんたがあたしを熱くさせてくれるまで、待ってるよ」
			CALL メッセージ欄表示用関数(LOCALS,"星晶獣マーズ",,0)
			CALL 口上変数初期化
			WSTR:(K++) = リゾートに[緋焔]マーズが現れるようになった！
			LOCAL = GETCHARA(138)
			CFLAG:LOCAL:招待不可フラグ = 0
		ELSE
			KSTR:(K++) = もう誰もいない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_バルツ地下廃工場_20_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 20
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "22_1")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 探索を続けていると、非常に広い空間に出た。
			WSTR:(K++) = 通路のようにも思えるが、横幅は家屋が２，３件並べられそうなほどに広い。
			WSTR:(K++) = 恐らくは機械型星晶獣が通るための広さなのだろう。
			WSTR:(K++) = 目的の星晶獣はこの先で間違いなさそうだ。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 星晶獣が通るための広い通路が伸びている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_20_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 20
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "20_1")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 通路の先で、暴走した機械に火の精霊が集まっていた。
			WSTR:(K++) = 敵対しているわけではなく、機械の動力から発する火の魔力に引き寄せられているらしい。
			WSTR:(K++) = つまりは共存関係にあるということだ。
			WSTR:(K++) = その推測を裏付けるかのように、%CALLNAME:PLAYER%たちに気づいた機械たちは連携して襲いかかってくる！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:0:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:4:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv12_暴走機械B
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 精霊と機械の連携を退け、制圧する。
				WSTR:(K++) = 火力の高い精霊に気を取られている内に機械の大技を食らうのは避けたいところだ。
				WSTR:(K++) = 速攻で倒すか、あるいは相手の攻撃を妨害するか。
				WSTR:(K++) = 何らかの対策を講じる必要があるだろう。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:4:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv12_暴走機械B
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_20_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 20
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "20_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "20_7")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 壁や床に触れるとまだ温かい。
			WSTR:(K++) = 冷却装置で気温は下がっても、構造物の内部は熱を持ったままのようだ。
			WSTR:(K++) = 恐らくは奥にいる機械型星晶獣の影響だろうが……。
			WSTR:(K++) = ……今までの討伐でこのようなことが起こったとは聞いていない。
			WSTR:(K++) = 何か妙なことが起こっているのかもしれない。気をつけて進もう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 壁や床に触れるとまだ温かい。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_20_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 20
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "22_7")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 脇道にあった通路を進んで見ると、幾分と涼しくなった。
			WSTR:(K++) = こちら側にはあまり熱気が回っていないようだ。
			WSTR:(K++) = 扉の上を見てみると、金属プレートで「設計室」と書かれている。
			WSTR:(K++) = 何かめぼしい資料でも残っていないだろうか。先を探索してみよう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 扉の上を見てみると、金属プレートで「設計室」と書かれている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_バルツ地下廃工場_22_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 22
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "22_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "23_1")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路の脇にパイプが伸びており、中からは異音がしている……。
			CALL 知識技能所持者検索("機械知識", 1)
			LOCAL = RESULT
			IF LOCAL > -1
				WSTR:(K++) = %CALLNAME:LOCAL%は急いでパイプに近づき、取り付けられていたバルブを回した。
				WSTR:(K++) = パイプ内部の圧力が逃され、すぐに異音は解消されていく。
				WSTR:(K++) = あのまま放置していればパイプが爆発していたことだろう。危ないところだった。
				WSTR:(K++) = 他に危険なパイプが無いかを確認し、%CALLNAME:PLAYER%たちは先に進む。
			ELSE
				WSTR:(K++) = 危険そうだから近寄らないでおこう。
				WSTR:(K++) = そう判断した%CALLNAME:PLAYER%たちが距離を取ると、突然パイプが爆発した！！
				WSTR:(K++) = 全員のＨＰが２００減少した！
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				FOR LOCAL, 0, 4
					SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
						CONTINUE
					BATTLE_STATE:LOCAL:ＨＰ = MAX(BATTLE_STATE:LOCAL:ＨＰ - 200, 0)
				NEXT
				WSTR:(K++) = パイプの耐久は限界だったようで、すぐに圧力を弱めなければならなかったようだ。
				WSTR:(K++) = 機械知識があれば正しく判断出来たかもしれないが……。
				WSTR:(K++) = 他に危険なパイプが無いかを確認し、%CALLNAME:PLAYER%たちは先に進む。
			ENDIF
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もう危険そうなパイプはない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_22_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 22
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "23_3")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 通路の中央で暴走機械と火の精霊が踊るように動き回っている。
			WSTR:(K++) = 見晴らしのいいこの場所では隠れて進むことは難しそうだ。
			WSTR:(K++) = 武器を構え、%CALLNAME:PLAYER%たちは戦いを始める。
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:2:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:1:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:4:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv12_暴走機械A
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 機械たちを打倒し、周囲の安全を確保する。
				WSTR:(K++) = しばらくすればまた新しい機械が現れ、それに惹かれて精霊たちも戻ってくるだろう。
				WSTR:(K++) = そうなる前に先に進もう。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:2:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:1:エネミー名 = Lv12_暴走機械A
			敵BATTLE_STATE_STR:4:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv12_暴走機械A
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_22_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 22
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		IF ダンジョン内一時変数:2 == 0
			ダンジョンマス画像URL_重ね表示 = えっちハート
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		;えっちイベ
		IF ダンジョン内一時変数:2
		ELSE
			CALL ダンジョンハプニング基本処理()
			IF RESULT
				ダンジョン内一時変数:2 = 1
			ENDIF
			CALL 口上変数初期化
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_22_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 22
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "22_6")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "23_7")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 設計室には幾つかの古い資料が残されていた。
			WSTR:(K++) = 保存状態が良かったのか、それなりに読める状態で残されている。
			WSTR:(K++) = 歴史的にも貴重な資料だ。バルツ大公に報告すれば買い取ってもらえるだろう。
			WSTR:(K++) = %CALLNAME:PLAYER%は50,000ルピを手に入れた！
			MONEY += 50000
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もうめぼしい資料は残っていない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_23_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 23
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;24_1へ
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 広い通路を封鎖する、巨大な隔壁が降りている。
			WSTR:(K++) = しかし隔壁もまた、高温に晒されて融解してしまっていた。
			WSTR:(K++) = 分厚い隔壁を溶かすほどの火力は、やはり星晶獣のものなのだろうか。
			WSTR:(K++) = 冷却装置が働いている以上、そう危険は無いと思うが……気をつけて進もう。
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(24, 1)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		ダンジョン現在位置:0 = 24
		ダンジョン現在位置:1 = 1
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_23_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 23
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 土砂に埋もれた出入り口を発見した。
			WSTR:(K++) = 構造からして地上に通じていそうだが、ここを掘り出すのはかなりの年月がかかるだろう。
			WSTR:(K++) = 恐らくはここから機械型星晶獣を出撃させる仕組みになっていたのではないだろうか。
			WSTR:(K++) = しかし今は役に立ちそうもない。別の場所を探索しよう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 出入り口は土砂に埋もれている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_23_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 23
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 設計室の奥に、興味深い設計図の束を見つけた。
			WSTR:(K++) = 乗り物に取り付けて運用するタイプの汎用的な武器の作り方だ。
			IF 鍛冶場作成許可フラグ
				WSTR:(K++) = これがあれば、新しい乗機用の武器を生産できそうだ！
			ELSE
				WSTR:(K++) = 何かの役に立つかもしれない。もらっていこう。
			ENDIF
			WSTR:(K++) = %CALLNAME:PLAYER%は複数の搭載兵器の設計図を手に入れた！
			CALL 汎用搭載兵器取得処理_設計図("10mmバルカン砲")
			CALL 汎用搭載兵器取得処理_設計図("19mm狙撃砲")
			CALL 汎用搭載兵器取得処理_設計図("30mm榴弾砲")
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もうめぼしいものはなにもない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_24_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 24
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "26_1")
	CASE "マスイベント"
		;23_1へ
		ダンジョン現在位置:0 = 23
		ダンジョン現在位置:1 = 1
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_25_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 25
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン_赤
	CASE "接続先"
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			CALL 強敵マス確認
			SIF RESULT == 1
				RETURN 0
			;最初に訪れた時
			WSTR:(K++) = %CALLNAME:PLAYER%たちは廃工場の一番奥にたどり着いた。
			WSTR:(K++) = 格納庫のようになっているそこには、黒い鋼で作られた巨人が佇んでいる。
			WSTR:(K++) = しかし、その巨人はやはり依頼の情報通り暴走しているようだ。
			WSTR:(K++) = %CALLNAME:PLAYER%たちの姿を確認した途端に起動し、君たちへと襲いかかってくる！！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:0:エネミー名 = Lv18_コロッサス
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;立ち絵リソース記録に必要な画像のリソースを生成する
				CALLF 顔グラ表示用文字列関数(キャラ検索("[鋼鉄の巨人]コロッサス"),100,,,1,1)
				LOCALS = %立ち絵リソース記録%
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = %CALLNAME:PLAYER%たちはコロッサスを討ち倒す。
				WSTR:(K++) = すると暴走状態が解除されたのか、コロッサスは敵意を収めて大人しくなったようだ。
				WSTR:(K++) = 赤く点灯していたアイランプも黄色になり、君たちを見つめているように思える。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「────」
				CALL メッセージ欄表示用関数(LOCALS,"星晶獣コロッサス",,0)
				CALL 口上変数初期化
				WSTR:(K++) = コロッサスが身じろぎし、機体から音を鳴らす。
				WSTR:(K++) = ただの駆動音のようだが、%CALLNAME:PLAYER%にはなんとなく何を話したいのかがわかる……
				WSTR:(K++) = これも星晶獣eraとの契約の影響だろうか……？
				CALL メッセージ欄表示用関数(LOCALS,"星晶獣コロッサス",,0)
				CALL 口上変数初期化
				WSTR:(K++) = コロッサスは暴走を止めてくれて%CALLNAME:PLAYER%たちに感謝をしているようだ。
				WSTR:(K++) = 更には何かお礼をしたい気持ちがある、ということも伝わってくる。
				CALL メッセージ欄表示用関数(LOCALS,"星晶獣コロッサス",,0)
				IF 鍛冶場作成許可フラグ == 0
					CALL 口上変数初期化
					WSTR:(K++) = それなら、と%CALLNAME:PLAYER%は一度リゾートを訪れてくれるようにお願いする。
					WSTR:(K++) = 強い装備の作るための施設作成を手伝って欲しいのだ、と伝えてみた。
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「────」
					WSTR:(K++) = コロッサスは問題ない、とばかりに駆動音を鳴らす。
					WSTR:(K++) = そして星晶獣としての力を使い、光を%CALLNAME:PLAYER%の目の前に集めると────
					CALL メッセージ欄表示用関数(LOCALS,"星晶獣コロッサス",,0)
				ELSE
					CALL 口上変数初期化
					WSTR:(K++) = %CALLNAME:PLAYER%は星晶獣に事情を話す。
					WSTR:(K++) = 鍛冶施設を作るので、その参考になるだろうと勧められて来たのだと。
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「────」
					WSTR:(K++) = ならば、とコロッサスは鍛冶施設の改良に力を使おうと提案する。
					WSTR:(K++) = 施設にコロッサスの力を使えば、バルツの施設に負けない効率が出せるだろうと。
					CALL メッセージ欄表示用関数(LOCALS,"星晶獣コロッサス",,0)
					CALL 口上変数初期化
					WSTR:(K++) = なら一緒に来てくれないか、と%CALLNAME:PLAYER%がコロッサスを誘う。
					WSTR:(K++) = するとコロッサスは星晶獣としての力を使い、光を%CALLNAME:PLAYER%の目の前に集めて────
					CALL メッセージ欄表示用関数(,,,0)
				ENDIF
				$選択肢ラベル
				CALL 口上変数初期化
				KSTR:(K++) = ※星晶獣コロッサスの扱いについて選択出来ます。
				KSTR:(K++) = 　任意の選択肢を選んでください。
				KSTR:(K++) = BUTTON_[人間大サイズのコロッサスとして活動する]
				KSTR:(K++) = BUTTON_[コロマグちゃんとして活動する]
				KSTR:(K++) = BUTTON_[コロマグちゃんって何？]_（説明を表示。これを選んでもシナリオは進みません）
				CALL メッセージ欄表示用関数(,,,0)
				$LOOP_MESSAGE
				INPUTS
				SELECTCASE RESULTS
					CASE "[人間大サイズのコロッサスとして活動する]"
						CALL 口上変数初期化
						WSTR:(K++) = 光が収まると、%CALLNAME:PLAYER%の前に2mを超える鋼の鎧が直立している。
						WSTR:(K++) = どうやら人間の施設で活動出来るようなサイズの分体を作ってくれたようだ。
						WSTR:(K++) = 協力が得られるのなら早い方がいい。
						WSTR:(K++) = %CALLNAME:PLAYER%は早速星晶獣コロッサスを連れてリゾートへと戻ることにした。_PAGE
						WSTR:(K++) = リゾートに[鋼鉄の巨人]コロッサスが訪れるようになった！
						IF 鍛冶場作成許可フラグ == 0
							WSTR:(K++) = 施設改造「鍛冶施設」が解放された！
							WSTR:(K++) = 道具屋に「火の魔石」が追加された！
						ELSE
							WSTR:(K++) = 鍛冶施設で消費するルピの額が１０％減少した！
						ENDIF
						LOCAL = GETCHARA(136)
					CASE "[コロマグちゃんとして活動する]"
						;立ち絵リソース記録に必要な画像のリソースを生成する
						CALLF 顔グラ表示用文字列関数(キャラ検索("[こうてつのきょじん]コロマグちゃん"),100,,,1,1)
						LOCALS = %立ち絵リソース記録%
						CALL 口上変数初期化
						WSTR:(K++) = 光が収まると、%CALLNAME:PLAYER%の前に120cm程度のドラフ族の少女が立っていた。
						WSTR:(K++) = どうやら人間の施設で活動出来るようなサイズの分体を作ってくれたようだ。
						WSTR:(K++) = 協力が得られるのなら早い方がいい。
						WSTR:(K++) = %CALLNAME:PLAYER%は早速星晶獣コロッサスを連れてリゾートへと戻ることにした。
						CALL メッセージ欄表示用関数(LOCALS,"コロマグちゃん",,0)
						CALL 口上変数初期化
						WSTR:(K++) = リゾートに[こうてつのきょじん]コロマグちゃんが訪れるようになった！
						IF 鍛冶場作成許可フラグ == 0
							WSTR:(K++) = 施設改造「鍛冶施設」が解放された！
							WSTR:(K++) = 道具屋に「火の魔石」が追加された！
						ELSE
							WSTR:(K++) = 鍛冶施設で消費するルピの額が１０％減少した！
						ENDIF
						LOCAL = GETCHARA(137)
					CASE "[コロマグちゃんって何？]"
						CALL 口上変数初期化
						WSTR:(K++) = ■コロマグちゃん
						WSTR:(K++) = 　二次創作によって生まれたキャラクター。
						KSTR:(K++) = 　「撃破されたコロッサス・マグナのコックピットから見つかり、そのまま騎空団で保護され
						WSTR:(K++) = 　　行動を共にするようになった１０歳前後のドラフ族少女」という設定。
						WSTR:(K++) = 　コロッサスを思わせる模様が入った大角を持ち、長く白い髪を靡かせた無口無表情な娘。
						WSTR:(K++) = 　その正体は不明だが、erablue_resortでは「コロッサスの精神を人化した存在」として扱う。
						CALL メッセージ欄表示用関数(,,,0)
						GOTO 選択肢ラベル
					CASEELSE
						CLEARLINE 1
					REUSELASTLINE  
						GOTO LOOP_MESSAGE
				ENDSELECT
				WSTR:(K++) = 指輪「コロッサスの指輪」を手に入れた！
				WSTR:(K++) = 搭載兵器「メタル・デストロイヤー」を手に入れた！
				WSTR:(K++) = バルツ地下廃工場をクリアしました、帰還します。
				CALL 汎用指輪取得処理("コロッサスの指輪", 1)
				CALL 汎用搭載兵器取得処理("メタル・デストロイヤー")
				CALL メッセージ欄表示用関数(,,,0)
				鍛冶場作成許可フラグ = 1
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
				CALL イベント完了フラグ汎用処理("【条件確認】強い装備が作れないか？")
				CFLAG:LOCAL:招待不可フラグ = 0
				CFLAG:LOCAL:信頼度 = 2000
				CALL FAVOR_LvUPCheck(LOCAL)
				CALL 口上変数初期化
				ダンジョン終了状況 = 討伐達成
				ダンジョンクリアフラグ_バルツ地下廃工場 = 1
			ENDIF
		ELSE
			KSTR:(K++) = コロッサスとの戦いの記憶を思い起こしますか？
			KSTR:(K++) = （ボスと再戦）
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE2
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					敵BATTLE_STATE_STR:0:エネミー名 = Lv18_コロッサス
					CALL 雑魚敵遭遇汎用処理
					IF RESULT == 0
						CALL 口上変数初期化
						WSTR:(K++) = 指輪「コロッサスの指輪」を手に入れた！
						CALL 汎用指輪取得処理("コロッサスの指輪", 1)
						CALL メッセージ欄表示用関数(,,,0)
					ENDIF
				CASE "[いいえ]"
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE2
			ENDSELECT
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_25_8(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 25
マス分岐 = 8

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "25_5")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ……！
			WSTR:(K++) = %CALLNAME:PLAYER%たちが廃工場を進んでいると、熱気がより一層強くなった。
			WSTR:(K++) = 更には奥から強い魔力を感じる。
			WSTR:(K++) = 恐らく、この先に「機械型星晶獣」がいるのだろう。
			WSTR:(K++) = 戦うのならば今のうちに準備を整えた方がいい。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = この奥に機械型星晶獣がいそうだ。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_26_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 26
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "26_4")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "28_1")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路の脇に、組み立て途中らしき機械型星晶獣のパーツが転がっている。
			WSTR:(K++) = 部品に火の魔力を感じるのか火の精霊たちが集まっているようだ。
			WSTR:(K++) = 幸い、そちらに気を取られているのか%CALLNAME:PLAYER%たちに襲いかかってくる気配はない。先に進もう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 通路の脇に組み立て途中らしき機械型星晶獣のパーツが転がっている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_26_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 26
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "28_4")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 通路を曲がると、大量の炎精霊が通路に溢れている。
			WSTR:(K++) = 手前にいた精霊たちと同じように、組み立て前のパーツに惹かれているようだ。
			WSTR:(K++) = しかしこの場所では気づかれずに進むことは難しい。戦って進まなければ。
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:0:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:4:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:7:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:8:エネミー名 = Lv13_火のエレメンタル
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 精霊を蹴散らし、道を確保する。
				WSTR:(K++) = どうやら精霊たちが集っていたパーツは武器パーツのようだ。
				WSTR:(K++) = 珍しくパッケージごと残っており、武器の図面も付属している。
				IF 鍛冶場作成許可フラグ
					WSTR:(K++) = 乗機の空きスペースに装備させることが出来るかもしれない。もらっていこう。
				ELSE
					WSTR:(K++) = 何かの役に立つかもしれない。もらっていこう。
				ENDIF
				WSTR:(K++) = %CALLNAME:PLAYER%は搭載兵器「近接用ブレード」とその設計図を手に入れた！
				CALL 汎用搭載兵器取得処理("近接用ブレード")
				CALL 汎用搭載兵器取得処理_設計図("近接用ブレード")
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:4:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:7:エネミー名 = Lv13_火のエレメンタル
			敵BATTLE_STATE_STR:8:エネミー名 = Lv13_火のエレメンタル
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_27_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 27
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "27_7")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 倉庫の中を調べていくが、どれも壊れていてまともな兵器は残っていないようだ。
			WSTR:(K++) = もう少し奥も調べてみよう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = まともな兵器は残っていない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_27_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 27
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 相変わらず壊れた兵器ばかりが転がっている。
			WSTR:(K++) = 何か掘り出し物はないかと探していると、壁の目立つ場所に赤い箱を見つけた。
			WSTR:(K++) = 箱には「緊急時用蘇生薬」と書いてある。
			WSTR:(K++) = 開けてみると、今でも使えそうな蘇生薬が２つ収められていた。
			WSTR:(K++) = 事故が起きた時の備えだろうか。ここに置いていてもしょうがない。ありがたく貰っていこう。
			WSTR:(K++) = %CALLNAME:PLAYER%は「蘇生薬」を２個手に入れた！
			CALL アイテム増減汎用処理("蘇生薬", 2)
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もうめぼしいものはなにもない
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_28_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 28
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "28_3")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 多くの機械型星晶獣が、壊れた状態で転がっている。
			WSTR:(K++) = この廃工場は古代の事故で封鎖され、最近になって機械型星晶獣の起動と同時に封鎖が解かれたはずだが……。
			WSTR:(K++) = 事故というには、破損した機体が多すぎる気がする。
			WSTR:(K++) = ともあれ、これらに現状危険はないようだ。
			WSTR:(K++) = 詳しい調査はバルツの専門家に任せ、自分たちは先に進もう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 多くの機械型星晶獣が壊れた状態で転がっている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_28_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 28
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "31_3")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = また壊れた機体の横を通り過ぎようとすると、側に落ちていた兵器パーツがふわりと浮き上がる！
			WSTR:(K++) = どうやら兵器の内部に精霊が取り憑いて動かしているようだ。
			WSTR:(K++) = 精霊憑きの兵器はそのまま、%CALLNAME:PLAYER%たちへ襲いかかってくる！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:1:エネミー名 = Lv14_精霊憑きの兵器パーツ
			敵BATTLE_STATE_STR:5:エネミー名 = Lv14_精霊憑きの兵器パーツ
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 撃退した兵器から精霊が逃げ出していく。
				WSTR:(K++) = 機体そのものではなく兵器に取り憑いていたのは不幸中の幸いだろう。
				WSTR:(K++) = あの機体が持つ装甲の分厚さでは、より手こずっていたに違いない。
				WSTR:(K++) = 残骸を端に寄せて%CALLNAME:PLAYER%たちは先に進む。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:1:エネミー名 = Lv14_精霊憑きの兵器パーツ
			敵BATTLE_STATE_STR:5:エネミー名 = Lv14_精霊憑きの兵器パーツ
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_28_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 28
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "28_6")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "30_4")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 奥へと進むたびに熱気が強くなっていく。冷却装置に勝るほどの熱源があるということなのだろう。
			WSTR:(K++) = 今はまだ平気だが、_COLOR_%カラーパレット_HTML("黄")%_工場の最奥では毎ターンダメージを受ける_かもしれない。
			WSTR:(K++) = これを防ぐためには自分で自分を冷やせるようになれば良い。
			WSTR:(K++) = _COLOR_%カラーパレット_HTML("黄")%_水属性になることで、ターンダメージを無効化_出来るだろう。
			WSTR:(K++) = 水属性の耳飾りを揃えておくといいかもしれない。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = _COLOR_%カラーパレット_HTML("黄")%_工場の最奥では毎ターンダメージを受ける_かもしれない。
			KSTR:(K++) = _COLOR_%カラーパレット_HTML("黄")%_水属性になることで、ターンダメージを無効化_出来るだろう。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_28_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 28
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "27_6")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "30_6")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路の脇に、大きな扉を見つけた。
			WSTR:(K++) = 扉の上には金属プレートで「兵器管理庫」と書かれている。
			WSTR:(K++) = 何か役立つものが残っているだろうか。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 扉の上に金属プレートで「兵器管理庫」と書かれている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_バルツ地下廃工場_30_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 30
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4)
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			WSTR:(K++) = 通路の突き当りに大きなボタンがある。
			IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:31:3, 2)
				WSTR:(K++) = 別の道で見かけた、閉まったシャッターを開けるボタンだろうか？
			ENDIF
			WSTR:(K++) = ボタンの上には金属プレートで「シャッター開閉」と書かれている。_PAGE
			KSTR:(K++) = ボタンを押しますか？
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					WSTR:(K++) = ボタンを押してみると、何か大きなものが動くような音が聞こえてきた。
					IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:31:3, 2)
						WSTR:(K++) = 閉まっていたシャッターを見に行ってみよう。
					ENDIF
					CALL メッセージ欄表示用関数(,,,0)
					SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
				CASE "[いいえ]"
					WSTR:(K++) = もう少し別の場所も探索してみよう。
					CALL メッセージ欄表示用関数(,,,0)
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
		ELSE
			KSTR:(K++) = ボタンはもう押されている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_30_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 30
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "30_7")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 倉庫の中に、現存する兵器を見つけた。
			WSTR:(K++) = ……と思ったら、兵器が一人でに動き出した！
			WSTR:(K++) = 炎の精霊が内部に取り憑いているようだ。兵器の体ごと、君たちに襲いかかってくる！
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:3:エネミー名 = Lv14_精霊憑きの兵器パーツ
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 撃退した兵器から精霊が逃げ出していく。
				WSTR:(K++) = 精霊の濃い魔力に晒された内部部品は大きく劣化してしまっている……。
				WSTR:(K++) = ……シンプルな部品なら、まだ幾つか使えそうなものが残っている！
				KSTR:(K++) = %CALLNAME:PLAYER%は古びた歯車を３個手に入れた！_PAGE
				WSTR:(K++) = 残骸を端に寄せて%CALLNAME:PLAYER%たちは先に進む。
				CALL 素材入手処理("古びた歯車", 3)
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:3:エネミー名 = Lv14_精霊憑きの兵器パーツ
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_30_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 30
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 倉庫の奥に、赤く輝く魔力の宝珠を見つけた。
			WSTR:(K++) = 内包する魔力が濃く、大型の機械を動かすための動力源……だと宝珠を収めた箱に書いてある。
			WSTR:(K++) = 幸いにして保管箱に入っていたためか劣化は殆ど見られない。ありがたく貰っていこう。
			WSTR:(K++) = %CALLNAME:PLAYER%は「紅蓮の宝珠」を１個手に入れた！
			CALL 素材入手処理("紅蓮の宝珠", 1)
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もうめぼしいものはなにもない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_バルツ地下廃工場_31_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 31
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
		SIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "31_8")
	CASE "マスイベント"
		IF GETBIT(ダンジョン構造配列_バルツ地下廃工場:30:4, 4)
			;開いてる
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 通路の途中で、破壊された機体がなくなっている場所を見つけた。
				WSTR:(K++) = これまでは多くのパーツが散乱していたが、ここより先は何も落ちていない。
				WSTR:(K++) = その代わりに熱気はますます強くなっているようだ。_PAGE
				WSTR:(K++) = 上を見ていると、シャッターが上がった状態になっている。
				WSTR:(K++) = 別の場所で見つけたスイッチがここのシャッターを上げるものだったのだろうか。
				WSTR:(K++) = ともあれ、動きやすい分に問題はない。%CALLNAME:PLAYER%たちは先に進む。
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ELSEIF GETBIT(ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4) == 0
				WSTR:(K++) = 閉まっていたシャッターが開いている。
				WSTR:(K++) = また、これまであったパーツや部品の散乱がこの先はなくなっている。
				WSTR:(K++) = その代わりに熱気はますます強くなっているようだ。
				WSTR:(K++) = ともあれ、動きやすい分に問題はない。%CALLNAME:PLAYER%たちは先に進む。
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_バルツ地下廃工場:マス深度:マス分岐, 4
			ELSE
				KSTR:(K++) = シャッターは既に開いている。
			ENDIF
		ELSE
			;閉まってる
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 通路の途中で耐火シャッターが閉められている。
				WSTR:(K++) = かなりの分厚さがあり、破壊するのは現実的ではなさそうだ。
				WSTR:(K++) = どこかに開閉する仕組みがないだろうか。探してみよう。
			ELSE
				KSTR:(K++) = 通路の途中で耐火シャッターが閉められている。
				KSTR:(K++) = どこかに開閉する仕組みがないだろうか。
			ENDIF
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_バルツ地下廃工場_31_8(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 31
マス分岐 = 8

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_工場
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "25_8")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = シャッターより先に進むと、部品の散乱どころか精霊や暴走機械の姿も見えない。
			WSTR:(K++) = 障害が無い分にはいいのだが……。
			WSTR:(K++) = どうにも平和というより、「嵐の前の静けさ」という印象を受ける。
			WSTR:(K++) = 気をつけて進もう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = このあたりには何もない。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT




