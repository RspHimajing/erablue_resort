@イベント発生条件_キャライベント_フェルンへの性教育
;開放条件を満たしたら1を返すこと
#DIM キャラ番号_フリーレン
#DIM キャラ番号_フェルン
#DIM キャラ番号_シュタルク
#DIM 縁結び数
#DIM DT_ID
#DIM 人物番号1
#DIM 人物番号2

キャラ番号_フリーレン = GETCHARA(1041)
キャラ番号_フェルン   = GETCHARA(1042)
キャラ番号_シュタルク = GETCHARA(1043)

;フリーレンが陥落済み
SIF 陥落チェック(キャラ番号_フリーレン) == 0
	RETURN 0
;フェルンが招待済み
SIF CFLAG:キャラ番号_フェルン:招待不可フラグ != 0
	RETURN 0
;フェルンが島にいる
;これ満たしてるなら↑のやついらなそうだけど、今後の参考文献的な意味で残しておく
SIF CFLAG:キャラ番号_フェルン:滞在期間 < 1
	RETURN 0
;フェルンが未陥落
SIF 陥落チェック(キャラ番号_フェルン) >= 1
	RETURN 0
;フェルンにシュタルク以外の縁結び相手がいないこと
縁結び数 = DT_SELECT("関係性データベース", @"(対象キャラ１ = {CFLAG:キャラ番号_フェルン:人物番号} Or 対象キャラ２ = {CFLAG:キャラ番号_フェルン:人物番号}) And (関係性種別 = '恋慕' Or 関係性種別 = 'セフレ')")
DT_ID = RESULT:1
IF 縁結び数
	;縁結び相手が複数いたら✕
	SIF 縁結び数 >= 2
		RETURN 0
	;縁結び相手がシュタルク以外だと✕
	人物番号1 = DT_CELL_GET("関係性データベース", DT_ID, "対象キャラ１", 1)
	人物番号2 = DT_CELL_GET("関係性データベース", DT_ID, "対象キャラ２", 1)
	SIF 人物番号1 != CFLAG:キャラ番号_シュタルク:人物番号 && 人物番号2 != CFLAG:キャラ番号_シュタルク:人物番号
		RETURN 0
ENDIF
;シュタルクが寝取られ性癖を持っていない
SIF 性癖素質:キャラ番号_シュタルク:寝取られ > 1
	RETURN 0
RETURN 1


@イベント消滅条件_キャライベント_フェルンへの性教育
;この条件を満たした時、イベントは発生してない扱いとなる
;発生条件＞消滅条件で見るので、発生と消滅を両方満たしている時は「発生した！」というメッセージが出るが発生していない扱いになる
;そのため条件には注意すること

;消滅条件を満たしたら1を返す
; IF 消滅条件式
; 	RETURN 1
; ENDIF
; RETURN 0

;例えば、「発生条件を満たしている時のみ出現させたい」のなら以下のようになる
CALL イベント発生条件_キャライベント_フェルンへの性教育
IF RESULT
	;発生条件OKなので0を返す
	RETURN 0
ELSE
	;発生条件アウトなので1を返す
	RETURN 1
ENDIF

@イベント関数_キャライベント_フェルンへの性教育(ARG)
#DIM キャラ番号_フリーレン
#DIM キャラ番号_フェルン
#DIM キャラ番号_シュタルク
#DIM イベント内容
#DIM CONST イベント内容_フェルンに性教育      = 0
#DIM CONST イベント内容_二人に性教育          = 1
#DIM CONST イベント内容_二人に性教育_縁結び済 = 2

キャラ番号_フリーレン = GETCHARA(1041)
キャラ番号_フェルン   = GETCHARA(1042)
キャラ番号_シュタルク = GETCHARA(1043)

;イベント内容の分岐判定
IF (TALENT:PLAYER:性別 & 2) && CFLAG:キャラ番号_シュタルク:招待不可フラグ == 0
	;あなたにＰがある ＆ シュタルクが招待可能
	IF DT_SELECT("関係性データベース", @"(対象キャラ１ = {CFLAG:キャラ番号_フェルン:人物番号} Or 対象キャラ１ = {CFLAG:キャラ番号_シュタルク:人物番号}) And (対象キャラ２ = {CFLAG:キャラ番号_フェルン:人物番号} Or 対象キャラ２ = {CFLAG:キャラ番号_シュタルク:人物番号}) And (関係性種別 = '恋慕' Or 関係性種別 = 'セフレ')")
		;シュタルクとフェルンが恋慕 or セフレ
		イベント内容 = イベント内容_二人に性教育_縁結び済
	ELSE
		イベント内容 = イベント内容_二人に性教育
	ENDIF
ELSE
	イベント内容 = イベント内容_フェルンに性教育
ENDIF

DRAWLINE
PRINTL ［フェルンへの性教育］
DRAWLINE
PRINTW
CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
PRINTL フリーレン：
PRINTFORMW 「──フェルンに、セックスを教えてやってほしいんだ」
PRINTL
PRINTFORMW フリーレンに「頼みたいことがあるんだけど」と相談を持ち掛けられた%CALLNAME:PLAYER%が頷くと、開口一番これである。
PRINTL
PRINTFORMW …………今なんて？
PRINTL
CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
PRINTL フリーレン：
PRINTFORMW 「だから、フェルンにセックスを教えてやってほしいんだ。 ……まぁ、まずは順を追って話すよ」
PRINTL
PRINTFORMW 「……フェルンはさ、戦災孤児だったんだよね」
PRINTL
PRINTFORMW 「幼いころに両親を亡くして、それからしばらくの間、ハイターっていう生臭坊主に引き取られて暮らしてた」
PRINTL
PRINTFORMW 「でもそのハイターってやつも高齢でね。寿命を悟ったハイターがフェルンを私に弟子入りさせて、こうして今は私と旅をしてる。あれからもう十年くらいは経つかな」
PRINTL
PRINTFORMW 「……でもさ、いくら師匠と弟子だからって、私が教えてあげられないこともあるんだよね」
PRINTL
PRINTFORMW 「知ってると思うけど、私みたいなエルフは、長い寿命をもつかわりに性欲とか繫殖欲求みたいなものがほとんどないんだ」
PRINTL
PRINTFORMW 「だから私は、旅のことや魔法のことはフェルンに教えてあげられるけど、男女のこととかは教えてあげられる自信がなくてね」
PRINTL
PRINTFORMW 「ハイターがそういうこと、教えてたとも思えないし……まぁそのうち時が来たらでいいやって後回しにしてたら、こうしてちょうどよさそうな『先生』に出会えたわけだし、いい機会かなって」
PRINTL
IF TALENT:キャラ番号_フリーレン:恋慕
	CALL PRINT_STRW(@"「……ふふ。なにせキミは、欲求の薄いエルフの私に『キミとの子供が欲しい』なんて思わせることができたほどだからね……_H_ヒンメルにだってそんなこと思わなかったのに」")
ELSE
	CALL PRINT_STRW(@"「なにせキミとのセックスは、生まれてこのかた性欲なんて感じたこともなかった私ですら、ついつい夢中になっちゃうくらいだからね」")
ENDIF
PRINTL
PRINTFORMW 「フェルンにとってもきっと、いい経験になると思うんだ」
IF イベント内容 == イベント内容_二人に性教育
	PRINTL 
	PRINTFORMW 「……それと、できればシュタルクにも、見学させてやってほしい」
	PRINTL
	PRINTFORMW 「いままでそういうことを学ぶ機会なんてなかっただろうし、アイゼン……シュタルクの師匠も、性教育なんてしてたとは思えないからさ。せめて見学の機会くらい必要だと思うんだ」
ELSEIF イベント内容 == イベント内容_二人に性教育_縁結び済
	PRINTL
	PRINTFORML フリーレンはそう言うが、フェルンにはシュタルクとの縁を結んでやったはずだ。
	PRINTFORMW どういうことか、と%CALLNAME:PLAYER%が問うと、フリーレンは苦笑して続けた。
	PRINTL
	CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
	PRINTL フリーレン：
	PRINTFORMW 「それがさ……フェルン、なんだか満足してないみたいなんだよね。表情でわかるよ。これでも師匠だからね」
	PRINTL
	PRINTFORMW 「シュタルクは戦士だし、体力はあるはずなんだけどね……単純にヘタなのかなって。まぁアイゼン……シュタルクの師匠もそういうこと教えてたとも思えないし、仕方ないけど」
	PRINTL
	PRINTFORMW 「だからさ、キミが教えてあげて欲しいんだ。二人に、セックスのやりかたを」
	PRINTL
	CALL PRINT_STRW(@"「キミとする『本当のセックス』はこんなに気持ちよくて、幸せなんだって、さ……_H_」")
ELSEIF TALENT:キャラ番号_フリーレン:恋慕
	PRINTL
	PRINTFORML そうは言うが、フリーレンは%CALLNAME:PLAYER%の恋人だろう。これでは浮気になってしまうのではないだろうか。
	PRINTFORMW 恋人として思うところはないのか、と%CALLNAME:PLAYER%が問うと、フリーレンは首を傾げた。
	PRINTL
	CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
	PRINTL フリーレン：
	PRINTFORMW 「うーん、嫉妬……とかは、ごめん、まだちょっとわからないかな」
	PRINTL
	PRINTFORMW 「でも、フェルンにもこの気持ちよさを教えたい、この幸せを知ってほしいって思うのは、師匠として当然のことじゃないかな？」
	PRINTL
	CALL PRINT_STRW(@"「……ふふ、せっかくだし、一緒にしてみるのもいいかもね。私とフェルンと、三人でさ……_H_」")
ENDIF
PRINTL
PRINTFORMW 「っていうことで……ね。どうかな？」
PRINTL
PRINTBUTTON "[0] わかった", 0
PRINTL
PRINTBUTTON "[1] すぐには決められない", 1
PRINTL
BINPUT
SELECTCASE RESULT
	CASE 0
		IF イベント内容 == イベント内容_二人に性教育
			PRINTL
			PRINTFORMW %CALLNAME:PLAYER%が了承すると、フリーレンはくすりと笑った。
			PRINTL
			CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
			PRINTL フリーレン：
			PRINTFORMW 「それはよかった。……ふふ、キミならきっと、いい先生になってくれるよ。私が保証する」
			PRINTL
			PRINTFORMW 「じゃあ、よさそうなタイミングを見計らってそのうち二人を連れてくるから、よろしくね」
			PRINTL
			PRINTFORMW フリーレンはそう言って、%CALLNAME:PLAYER%の頬に感謝のキスをした。
			PRINTL
			PRINTFORMW ────
			PRINTL
			PRINTFORML フリーレンの頼みを引き受けたことで、次のイベントが発生します。
			SIF !FLAG:クリア済み視聴フラグ
				フェルン性教育イベフラグ = 1
		ELSEIF イベント内容 == イベント内容_二人に性教育_縁結び済
			PRINTL
			PRINTFORMW %CALLNAME:PLAYER%が了承すると、フリーレンはくすりと笑った。
			PRINTL
			CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
			PRINTL フリーレン：
			PRINTFORMW 「それはよかった。……ふふ、キミならきっと、フェルンが満足するようなセックスを教えてあげられるよ」
			PRINTL
			PRINTFORMW 「じゃあ、よさそうなタイミングを見計らってそのうち二人を連れてくるから、よろしくね」
			PRINTL
			PRINTFORMW フリーレンはそう言って、%CALLNAME:PLAYER%の頬に感謝のキスをした。
			PRINTL
			PRINTFORMW ────
			PRINTL
			PRINTFORML フリーレンの頼みを引き受けたことで、次のイベントが発生します。
			SIF !FLAG:クリア済み視聴フラグ
				フェルン性教育イベフラグ = 1
		ELSE
			PRINTL
			PRINTFORMW %CALLNAME:PLAYER%が了承すると、フリーレンはくすりと笑った。
			PRINTL
			CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
			PRINTL フリーレン：
			PRINTFORMW 「それはよかった。……実はもうさ、フェルンには話してあるんだよね、このこと」
			PRINTL
			PRINTFORMW 「フェルンももうずいぶん大きくなったからね。人間だから、もう子供だっていてもおかしくない年齢だし」
			PRINTL
			PRINTFORMW 「戸惑ってはいたけれど……ふふ、興味津々って感じだったよ」
			PRINTL
			PRINTFORMW そう言って悪戯っぽく笑ったフリーレンは、信頼しきった様子で%CALLNAME:PLAYER%に身を寄せると
			PRINTL
			PRINTFORMW 「それじゃあ、フェルンをよろしくね」
			PRINTL
			PRINTFORMW と、%CALLNAME:PLAYER%の頬にそっとキスをした。
			PRINTL
			PRINTFORMW ────
			PRINTL
			PRINTFORML フリーレンの許可を得たことで、フェルンに対して『性教育』を行えるようになりました。
			PRINTFORMW 成熟してなお無知な彼女のカラダに、「本当のセックス」というものを存分に教えてあげよう！
			SIF !FLAG:クリア済み視聴フラグ
				フェルン性教育イベフラグ = 2
			;CSTR:キャラ番号_フェルン:固有素質0 = 性の教え子
		ENDIF
	CASE 1
		PRINTL
		PRINTFORMW %CALLNAME:PLAYER%が答えに迷っていると、フリーレンはくすりと笑った。
		PRINTL
		CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
		PRINTL フリーレン：
		PRINTFORMW 「まぁ、考えておいてよ。フェルンには私から話しておくからさ」
		PRINTL
		PRINTFORML フリーレンに甘えて、答えは保留とさせてもらった。
		PRINTFORMW フェルンにセックスを教えてあげたくなったら、その時はもう一度フリーレンとこの話をするとしよう。
		RETURN 0
ENDSELECT


CALL イベント完了フラグ汎用処理("フェルンへの性教育")






