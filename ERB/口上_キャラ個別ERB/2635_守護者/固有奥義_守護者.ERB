
@固有奥義_2635(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 奥義威力
#DIMS 奥義名
#DIM 守護者隊列
#DIM 救世威力
#DIM 味方番号
#DIM 蘇生
#DIM 回復量

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
	IF 陥落チェック(キャラ番号)
		奥義名 = 救世の翼＋＋＋
		救世威力 = 500
	ELSE
		奥義名 = 救世の翼＋＋
		救世威力 = 400
	ENDIF
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 18
	奥義名 = 救世の翼＋
	救世威力 = 350
ELSE
	奥義名 = 救世の翼
	救世威力 = 300
ENDIF
	奥義威力 = 0

;奥義威力を0にした場合、通常の奥義処理は行われず奥義追加効果のみが行われる。
;全体攻撃にしたい時や、攻撃しない奥義を作る場合は0に設定のこと


;下の４つの文字列に文章を入れると、対象選択時の文章を変化させることが出来る。
;これらを使わない場合は「誰を攻撃しますか？」と表示される。
;アビ汎用文字列:選択時メッセージ１ = 
;アビ汎用文字列:選択時メッセージ２ = 
;アビ汎用文字列:選択時メッセージ３ = 
;アビ汎用文字列:選択時メッセージ４ = 

;下の４つの文字列に文章を入れると、奥義使用時の文章を変化させることが出来る。
;これらを使わない場合は「（キャラ名）の奥義：（奥義名）！」と表示される。
;アビ汎用文字列:実行時メッセージ１ = 
;アビ汎用文字列:実行時メッセージ２ = 
;アビ汎用文字列:実行時メッセージ３ = 
;アビ汎用文字列:実行時メッセージ４ = 

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = %奥義名%
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：{救世威力}％<br>敵全体に攻撃。その後味方全体を蘇生し、ダメージカット１００％（１ターン）を付与。 
			SIF 基礎BATTLE_STATE:キャラ番号:Lv >= 50
				詳細文文字列受け渡し変数 += @"<br>更に味方全体を自身の最大ＨＰの７０％回復。"
		RETURN 奥義威力
	CASE "奥義前効果"
		CALL アビ汎用変数文字列リセット
	CASE "奥義追加効果"
		;これでとどめさすとかっこいいよね
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵全体_生者のみ
		アビ汎用文字列:ダメージ種類 = 奥義ダメージ
		アビ汎用変数:効果割合 = 救世威力
		CALL アビテンプレート_ダメージ処理_風属性

		;３ゲージでも安心！
		FOR 味方番号, 0, 4
			SIF BATTLE_STATE:味方番号:キャラ登録番号 < 1
				CONTINUE
			IF BATTLE_STATE:味方番号:ＨＰ < 1
				蘇生 = 1
			ELSE
				蘇生 = 0
			ENDIF
		NEXT
		IF 蘇生 == 1
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_死者のみ
			アビ汎用変数:蘇生可能オプション = 1
			アビ汎用文字列:回復側使用能力値 = 回復対象_最大ＨＰ
			アビ汎用変数:数値乱数幅 = 0
			アビ汎用変数:効果割合 = 33
			CALL アビテンプレート_回復処理_MAXでも回復
			CALL アビ汎用変数文字列リセット
		ENDIF

		;防御陣部分
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用変数:効果割合 = 300
		アビ汎用文字列:バフ・デバフ枠 = 防御陣
		アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
		アビ汎用変数:持続ターン = 1
		CALL アビテンプレート_有利効果_バフ効果セット

		;５０以上だと遺物を付けてるので味方も回復する
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 50
			FOR 味方番号, 0, 4
				SIF BATTLE_STATE:味方番号:キャラ登録番号 < 1
					CONTINUE
				SIF BATTLE_STATE:味方番号:ＨＰ < 1
					CONTINUE
				CALL アビ汎用変数文字列リセット
				CALL アビ対象選択テンプレート_指定(味方番号)
				回復量 = BATTLE_STATE:味方番号:最大ＨＰ * 70 / 100
				アビ汎用変数:効果量 = 回復量
				CALL アビテンプレート_回復処理_MAXでも回復
			NEXT
		ENDIF
ENDSELECT

